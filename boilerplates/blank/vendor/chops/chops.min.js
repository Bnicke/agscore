/**
 * Chops - Client HTML5 on Push State
 *
 * @version 0.0.9
 * @author Christian Blanquera <cblanquera@openovate.com>
 * @website https://github.com/cblanquera/chops
 * @license MIT
 */
!function(){var t=function(){var t=jQuery,n=!1,i="";this.___construct=function(){this._hijackPushState(),this._hijackPopState(),this._hijackLinks(),this._hijackForms()},this.getState=function(t){return t?r(t):window.history.state&&"number"!=typeof window.history.state?window.history.state:r(window.location.href)},this.on=function(n,i){return t(window).on(n,i),this},this.once=function(n,i){return t(window).one(n,i),this},this.off=function(n,i){return i?(t(window).unbind(n,i),this):(t(window).unbind(n),this)},this.redirect=function(t){return s(t),this},this.setRoot=function(t){return i=t.replace("/index.html","").replace(/\/\//gi,"/"),i.lastIndexOf("/")===i.length-1&&(i=i.substr(0,i.length-1)),this},this.trigger=function(){return t(window).trigger.apply(t(window),arguments),this},this.useHash=function(){return n=!0,""===i&&this.setRoot(window.location.pathname),this},this._hijackPushState=function(){var n=window.history.pushState;window.history.pushState=function(i,e,o){"function"==typeof window.history.onpushstate&&window.history.onpushstate({state:i});var r=n.apply(window.history,arguments),s=jQuery.Event("request");return s.state=i,t(window).trigger(s,[o,i]),r}},this._hijackPopState=function(){window.onpopstate=function(){var n=r(window.location.href),i=jQuery.Event("request");i.state=n,t(window).trigger(i,[window.location.href,n])}},this._hijackLinks=function(){t(document).on("click","a",function(t){t.originalEvent&&t.originalEvent.stop||0===this.href.indexOf(window.location.origin)&&(t.preventDefault(),s(this.href))})},this._hijackForms=function(){t(document.body).on("submit","form",function(n){t(this).attr("action")&&t(this).attr("action").length&&0!==t(this).attr("action").indexOf(window.location.origin)&&0!==t(this).attr("action").indexOf("/")||n.originalEvent.stop||(n.preventDefault(),a(this))})};var e=function(t){var n={};if(0==t.length)return{};for(var i,e,o,r,s,a,u=t.split("&"),h=0;h<u.length;h++){if(i=u[h].split("="),i[1]=i[1]||"",r=decodeURIComponent(i[0].replace(/\+/g,"%20")),s=decodeURIComponent(i[1].replace(/\+/g,"%20")),!i[1]){if(!i[0])continue;s=null}if("string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||-1==s.indexOf(".")?"string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||(s=parseInt(s)):s=parseFloat(s),-1!=r.indexOf("[")){for(e=r.split("["),current=n,a=0;a<e.length&&(r=e[a].replace("]",""),a+1!=e.length);a++)current[r]||(o={},("]"==e[a+1]||!isNaN(parseFloat(e[a+1].replace("]","")))&&isFinite(e[a+1].replace("]","")))&&(o=[]),current instanceof Array?current.push(o):current[r]=o),current=current instanceof Array?current[current.length-1]:current[r];current instanceof Array?current.push(s):current&&(current[r]=s)}else n[r]=s}return n},o=function(t,n){for(var i in t)t.hasOwnProperty(i)&&("string"==typeof t[i]&&0===t[i].indexOf("____CHOPS____")&&("undefined"==typeof n[t[i].substr(13)]&&delete t[i],t[i]=n[t[i].substr(13)]),"object"==typeof t[i]&&null!==t[i]&&o(t[i],n))},r=function(t){var i={url:t,path:t.split("#").shift().split("?").shift(),query:"",hash:"",json:"",method:"GET",data:{},serial:[],files:[]},o=window.location.protocol+"//"+window.location.hostname;window.location.port&&(o+=":"+window.location.port),0===i.path.indexOf(o)&&(i.path=i.path.substr(o.length).split("?")[0]),-1!==t.indexOf("#")&&(i.hash=t.split("#").pop()),n&&(i.path=i.hash.split("?")[0]||"/",i.hash=""),-1!==i.url.indexOf("?")&&(i.query=i.url.split("?")[1]),i.data=e(i.query),i.json=JSON.stringify(i.data);var r=[];i.query.length&&(r=i.query.split("&"));for(var s,a=0;a<r.length;a++)s=r[a].split("="),i.serial.push({name:s.shift(),value:s.join("=")});return i},s=function(t){var e=window.location.protocol+"//"+window.location.hostname;window.location.port&&(e+=":"+window.location.port),n&&(0===t.indexOf(e)?(t=t.substr(e.length),t=e+i+"/#"+t):t=i+"/#"+t),0!==t.indexOf(e)&&(t=e+t);var o=r(t);window.history.pushState(o,"",t)},a=function(s){var a=t(s).attr("action")||window.location.href;if(n){var u=window.location.protocol+"//"+window.location.hostname;window.location.port&&(u+=":"+window.location.port),0===a.indexOf(u)?(a=a.substr(u.length),a=u+i+"/#"+a):a=i+"/#"+a}var h=r(a);h.method=t(s).attr("method")||"GET",h.method=h.method.toUpperCase(),h.query=t(s).serialize(),h.serial=t(s).serializeArray(),h.data=e(h.query),h.json=JSON.stringify(h.data),"GET"===h.method&&(-1!==h.url.indexOf("?")&&(h.url=h.url.split("?")[0]),h.url+="?"+h.query);var c={query:h.query,items:{}};t('input[type="file"]',s).each(function(){if(this.name&&this.name.length)for(var t=0,n=0;n<this.files.length;n++)h.files.push({name:this.name+"[]",value:this.files[n]}),c.items[++t]=this.files[n],c.query+="&"+this.name+"[]=____CHOPS____"+t}),c.data=e(c.query),o(c.data,c.items),h.data=c.data,window.history.pushState(h,"",h.url)}};"function"==typeof define?define(["jquery","classified"],function(n,i){return i(t).singleton()}):"function"==typeof jQuery&&"function"==typeof jQuery.extend?jQuery.extend({chops:jQuery.classified(t).singleton()}):"object"==typeof window&&(window.chops=window.classified(t).singleton())}();